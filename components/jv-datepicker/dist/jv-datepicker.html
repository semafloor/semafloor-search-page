<link rel="import" href="../../polymer/polymer.html"><link rel="import" href="jv-datepicker-icons.html"><link rel="import" href="datepicker-slide-from-left-animation.html"><link rel="import" href="datepicker-slide-from-right-animation.html"><link rel="import" href="../../iron-selector/iron-selector.html"><link rel="import" href="../../iron-list/iron-list.html"><link rel="import" href="../../paper-icon-button/paper-icon-button.html"><link rel="import" href="../../neon-animation/neon-animated-pages.html"><link rel="import" href="../../neon-animation/neon-animation-runner-behavior.html"><link rel="import" href="../../neon-animation/animations/fade-in-animation.html"><link rel="import" href="../../neon-animation/animations/fade-out-animation.html"><link rel="import" href="../../neon-animation/animations/slide-from-left-animation.html"><link rel="import" href="../../neon-animation/animations/slide-from-right-animation.html"><dom-module id="jv-datepicker"> <template strip-whitespace> <style>:host{user-select:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;box-sizing:border-box;background:var(--jv-datepicker-bg,#fafafa);@apply(--jv-datepicker);display:block}*,::after,::before{box-sizing:inherit}div.datepicker{position:relative;width:300px;height:384px;max-height:384px;@apply(--layout-vertical)}div.datepicker.with-buttons{height:431px;max-height:431px}div.selected-date,div.selected-year{font-weight:800;height:34px;cursor:pointer}iron-selector.selected-fulldate{min-height:84px;padding:8px 24px;color:var(--jv-datepicker-selection-color,#b2dfdb);background-color:var(--jv-datepicker-selection-bg,#009688);@apply(--layout-vertical)}div.selected-date.iron-selected,div.selected-year.iron-selected{color:var(--jv-datepicker-iron-selected,#fefefe)}div.selected-year{font-size:14px;@apply(--layout-horizontal);@apply(--layout-center)}div.selected-date{font-size:32px;@apply(--layout-horizontal);@apply(--layout-center)}neon-animated-pages.fullcalendar{width:100%;height:100%;overflow:hidden;color:var(--jv-datepicker-calendar-color,#000);background-color:var(--jv-datepicker-calendar-bg,#fafafa);@apply(--layout-vertical)}div.navigator{max-height:46px;padding:3px 10px;position:relative;margin-top:8px;@apply(--layout-horizontal);@apply(--layout-center-center)}div.nav-month-year{font-size:14px;font-weight:500;text-align:center;@apply(--layout-flex-auto)}div.days-of-week{color:var(--jv-datepicker-weekdays-color,#9b9b9b);@apply(--layout-horizontal);@apply(--layout-center-center)}div.each-days-of-week{font-size:10px;padding:13px;max-height:32px;width:41px;@apply(--layout-horizontal);@apply(--layout-center-center)}div.days-of-month{@apply(--layout-horizontal);@apply(--layout-wrap);@apply(--layout-center-justified)}div.each-days-of-month{font-size:10px;height:35px;width:35px;margin-left:3px;margin-right:3px;position:relative;@apply(--layout-horizontal);@apply(--layout-center-center)}div>div.days-of-month>div.each-days-of-month.chosen-days-of-month{border-radius:50%;background-color:var(--jv-datepicker-selected-day-bg,#009688);color:var(--jv-datepicker-selected-day-color,#fff)}div.days-of-month>div.each-days-of-month.is-today{color:var(--jv-datepicker-today-color,#009688)}div.days-of-month>.each-days-of-month.is-disabled-day{color:var(--jv-datepicker-disabled-color,#9e9e9e)}div.each-days-of-month:not(.is-non-selectable){cursor:pointer}div.each-list-of-years{height:64px;cursor:pointer;@apply(--layout-horizontal);@apply(--layout-center-center)}div.each-list-of-years.is-selected{background-color:var(--jv-datepicker-selected-year-bg,#f5f5f5);color:var(--jv-datepicker-selected-year-color,#009688);font-weight:800}paper-icon-button{color:var(--jv-datepicker-icon-button-color,#737373);--paper-icon-button-ink-color:var(--jv-datepicker-icon-button-ink-color, #737373)}div.calendar-view>::content>div.buttons{color:var(--jv-datepicker-button-color,#009688);position:relative;padding:8px 8px 8px 24px;margin:0;@apply(--layout-horizontal);@apply(--layout-end-justified)}@media all and (orientation:landscape){div#dp.datepicker{width:512px;height:241px;@apply(--layout-horizontal)}div#dp.datepicker.with-buttons{height:288px}iron-selector.selected-fulldate{width:calc(100% / 3 + 48px);height:100%}div.each-days-of-month,div.each-days-of-week{margin-left:10px;margin-right:10px;width:calc(100% / 7 - 20px)}div.selected-date{height:68px;@apply(--layout-vertical);@apply(--layout-start);@apply(--layout-center-justified)}neon-animated-pages.fullcalendar{height:100%}div.calendar-view{padding-bottom:0}div.navigator{padding:2px 10px;margin-top:0}div.each-days-of-week{padding:0}div.each-days-of-month{height:29px}}</style> <div id="dp" class="datepicker"> <iron-selector selected="{{_activeView}}" class="selected-fulldate" attr-for-selected="view"> <div class="selected-year" view="year"> [[_selectedYear]] </div><div class="selected-date" view="calendar"> [[_selectedDaysOfWeek]],&nbsp; <span>[[_computeShortMonthName(_selectedMonth)]] [[_selectedDate]]</span> </div></iron-selector> <neon-animated-pages class="fullcalendar" selected="[[_activeView]]" attr-for-selected="view" entry-animation="[[pageEntryAnimation]]" exit-animation="[[pageExitAnimation]]"> <div class="calendar-view" view="calendar"> <div class="navigator"> <paper-icon-button icon="datepicker:chevron-left" on-transitionend="_decrementMonth" on-tap="_decrementMonth" noink="[[noAnimation]]"></paper-icon-button> <div id="navMonthYear" class="nav-month-year"> [[_computeMonthName(_activeMonth)]] [[_activeYear]] </div><paper-icon-button icon="datepicker:chevron-right" on-transitionend="_incrementMonth" on-tap="_incrementMonth" noink="[[noAnimation]]"></paper-icon-button> </div><div id="daysOfWeek" class="days-of-week"> <template is="dom-repeat" items="[[_daysOfWeek]]" index-as="index" strip-whitespace> <div class="each-days-of-week"> [[item]] </div></template> </div><div id="daysOfMonth" class="days-of-month" on-tap="_chooseDaysOfMonth"> <template is="dom-repeat" items="[[_daysOfMonth]]" index-as="index" strip-whitespace> <div class$="each-days-of-month[[_isToday(item, _activeYear, _activeMonth)]][[_isEmptyDate(item)]][[_isChosenDaysOfMonth(item, _selectedYear, _selectedMonth, _selectedDate)]][[_isDisableDays(index, disableDays.*, minDate, maxDate, item)]]" index="[[index]]" date="[[item]]"> [[item]] </div></template> </div><content select=".buttons"></content> </div><template is="dom-if" if="[[_isListUpdated]]" restamp="true" strip-whitespace> <iron-list id="listOfYears" items="[[_listOfYears]]" view="year"> <template strip-whitespace> <div class$="each-list-of-years[[_isListOfYearsSelected(item.year, _activeYear)]]" on-tap="_goCalendar"> [[item.year]] </div></template> </iron-list> </template> </neon-animated-pages> </div></template> <script>var _monthNames=["January","February","March","April","May","June","July","August","September","October","November","December"];var _dayNames=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];Polymer({is:"jv-datepicker",hostAttributes:{role:"datepicker"},behaviors:[Polymer.NeonAnimationRunnerBehavior],properties:{firstDayOfWeek:{type:Number,value:0},disableDays:{type:Array,value:function(){return[6,0]}},minDate:{type:String,value:"1000-00-01"},maxDate:{type:String,value:"9999-99-99"},format:{type:String,value:"yyyy-mm-dd"},date:{type:String,value:function(){var d=new Date();var c=d.getFullYear();var b=this._padStart(d.getMonth()+1,2,"0");var a=this._padStart(d.getDate()+1,2,"0");return[c,b,a].join("-")},notify:true,readOnly:true},inputDate:String,noAnimation:Boolean,pageEntryAnimation:String,pageExitAnimation:String,showLongDate:{type:Boolean,value:!1},invalidDate:{type:Boolean,notify:true,readOnly:true},_daysOfWeek:{type:Array,computed:"_computeDaysOfWeek(firstDayOfWeek)"},_daysOfMonth:Array,_listOfYears:Array,_activeView:{type:String,value:"calendar"},_activeYear:{type:Number,value:function(){return new Date().getFullYear()}},_activeMonth:{type:Number,value:function(){return new Date().getMonth()}},_isIncrementMonth:Boolean,_isDecrementMonth:Boolean,_selectedYear:{type:Number,value:new Date().getFullYear()},_selectedMonth:{type:Number,value:new Date().getMonth()},_selectedDate:{type:Number,value:new Date().getDate()},_selectedDaysOfWeek:{type:String,value:function(){var a=new Date().getDay();if(a<0){a=6}return _dayNames[a].slice(0,3)}},_chosenDaysOfMonth:{type:Number,value:function(){return new Date().getDate()}},_isListUpdated:{type:Boolean,value:!1},_isSelectedDateConfirmed:Boolean,_format:{type:Object,value:function(){return{y:"yyyy",m:"mm",d:"dd",s1:"-",s2:"-"}}}},observers:["_computeDaysOfMonth(_activeYear, _activeMonth, firstDayOfWeek)","_updateList(_activeView)","_computeSeparateFormat(format)","_computeShowLongDate(showLongDate)","_updateToReflectExternalChange(inputDate)"],ready:function(){},attached:function(){if(!this.noAnimation){this.set("animationConfig",{incrementEntry:[{name:"slide-from-right-animation",node:this.$.daysOfWeek},{name:"slide-from-right-animation",node:this.$.daysOfMonth},{name:"datepicker-slide-from-right-animation",node:this.$.navMonthYear}],decrementEntry:[{name:"slide-from-left-animation",node:this.$.daysOfWeek},{name:"slide-from-left-animation",node:this.$.daysOfMonth},{name:"datepicker-slide-from-left-animation",node:this.$.navMonthYear}]});this.set("pageEntryAnimation","fade-in-animation");this.set("pageExitAnimation","fade-out-animation")}var a=this.getEffectiveChildren();var c=Polymer.dom(a[0]).querySelectorAll("paper-button");if(a[0]&&c.length>0){for(var b=0;b<c.length;b++){if(c[b].hasAttribute("dialog-confirm")){c[b].addEventListener("tap",this._updateBindDate.bind(this));c[b].addEventListener("transitionend",this._updateBindDate.bind(this))}}this.$.dp.classList.add("with-buttons")}else{this.$.dp.classList.remove("with-buttons")}this.fire("jv-datepicker-attached")},detached:function(){},_computeDaysOfMonth:function(d,a,g){function f(j,i){var l=31;if(i===1){l=new Date(j,1,29).getMonth()===1?29:28}else{if(i===3||i===5||i===8||i===10){l=30}}return l}var b=new Date(d,a,1).getDay();var k=[];var h=f(d,a);if(g>0&&g<7){b=b-g;b=b<0?7+b:b}for(var e=0,c=1-b;e<42;e++,c++){k.push((e>=b&e<b+h?c:""))}this.set("_chosenDaysOfMonth",this._computeChosenDaysOfMonth(k));this.set("_daysOfMonth",k)},_incrementMonth:function(a){this.debounce("_incrementMonth",function(){var c=a.type;if(c==="tap"){this.set("_isIncrementMonth",!0)}if(c==="transitionend"||this.noAnimation){if(this._isIncrementMonth){var b=this._activeMonth;if(++b>11){this._activeYear++}this.set("_activeMonth",b>11?0:b);if(!this.noAnimation){this.cancelAnimation();this.playAnimation("incrementEntry")}this.set("_isIncrementMonth",!1)}}},1)},_decrementMonth:function(a){this.debounce("_decrementMonth",function(){var c=a.type;if(c==="tap"){this.set("_isDecrementMonth",!0)}if(c==="transitionend"||this.noAnimation){if(this._isDecrementMonth){var b=this._activeMonth;if(--b<0){this._activeYear--}this.set("_activeMonth",b<0?11:b);if(!this.noAnimation){this.cancelAnimation();this.playAnimation("decrementEntry")}this.set("_isDecrementMonth",!1)}}},1)},_computeMonthName:function(a){return _monthNames[a]},_computeShortMonthName:function(a){return _monthNames[a].slice(0,3)},_chooseDaysOfMonth:function(c){var a=c.target;if(a&&this._isNumber(a.date)&&!a.classList.contains("is-disabled-day")){if(this._chosenDaysOfMonth!==99){var b=Polymer.dom(this.$.daysOfMonth).querySelectorAll("div");this.toggleClass("chosen-days-of-month",!1,b[this._chosenDaysOfMonth])}this.toggleClass("chosen-days-of-month",!0,a);this.set("_chosenDaysOfMonth",a.index);this.set("_selectedDate",a.date);this.set("_selectedYear",this._activeYear);this.set("_selectedMonth",this._activeMonth);this.set("_selectedDaysOfWeek",this._computeShortDayName(a.index%7))}},_computeShortDayName:function(a){return _dayNames[a].slice(0,3)},_isToday:function(c,d,a){var b=new Date();if(c===b.getDate()&&d===b.getFullYear()&&a===b.getMonth()){return" is-today"}return""},_isEmptyDate:function(a){if(this._isNumber(a)){return""}return" is-non-selectable"},_isChosenDaysOfMonth:function(a,d,c,b){if(this._chosenDaysOfMonth!==99&&this._activeYear===d&&this._activeMonth===c&&a===b){return" chosen-days-of-month"}return""},_isDisableDays:function(g,c,d,k,f){var i=this.disableDays.some(function(l){return l===g%7});var e;var h;if(this._isNumber(f)){var b=this._computeMinDate(d);var j=this._computeMaxDate(k);var a=new Date(this._activeYear,this._activeMonth,f);if(!this._isUndefined(b)){e=a<new Date(b.year,b.month-1,b.date)}if(!this._isUndefined(j)){h=a>new Date(j.year,j.month-1,j.date)}}if(i||e||h){return" is-disabled-day"}return""},_isListOfYearsSelected:function(b,a){return b===a?" is-selected":""},_computeDaysOfWeek:function(b){if(b>0&&b<7){var a=["S","M","T","W","T","F","S"];var d=a.slice(b);var c=a.slice(0,b);var e=Array.prototype.concat(d,c);return e}return["S","M","T","W","T","F","S"]},_computeChosenDaysOfMonth:function(a){var b=a.indexOf(this._selectedDate);if(b>0){return b}},_computeMinDate:function(b){var c=/(\d{4})[^a-zA-Z0-9]+(\d{2})[^a-zA-Z0-9]+(\d{2})/i;var a=c.exec(b);if(a!==null){return{year:parseInt(a[1]),month:parseInt(a[2]),date:parseInt(a[3])}}},_computeMaxDate:function(c){var b=/(\d{4})[^a-zA-Z0-9]+(\d{2})[^a-zA-Z0-9]+(\d{2})/i;var a=b.exec(c);if(a!==null){return{year:parseInt(a[1]),month:parseInt(a[2]),date:parseInt(a[3])}}},_updateList:function(b){if(b==="year"){if(!this._isListUpdated){this.set("_isListUpdated",!0);if(!this._listOfYears){for(var a=[],d=1900,c=d;c<=2100;c++){a.push({year:c})}this.set("_listOfYears",a)}this.async(function(){this.$$("#listOfYears").selectItem(this._activeYear-1900);this.$$("#listOfYears").scrollToIndex(this._activeYear-1900-1);this.$$("#listOfYears").notifyResize()},1)}else{this.$$("#listOfYears").scrollToIndex(this._activeYear-1900-2);this.$$("#listOfYears").notifyResize()}}},_goCalendar:function(a){var b=a.model.item.year;this.set("_activeYear",b);this.set("_selectedYear",b);this.set("_activeView","calendar")},_computeSeparateFormat:function(c){var e=/(yyyy|yy)[^a-zA-Z0-9]+(mmmm|mmm|mm|m)[^a-zA-Z0-9]+(do|dd|d)/i;var d=/\w+([^a-zA-Z0-9]+)\w+([^a-zA-Z0-9]+)\w+/i;var b=e.exec(c);var f=d.exec(c);var a={};if(b!==null&&f!==null){a.y=b[1];a.m=b[2];a.d=b[3];a.s1=f[1];a.s2=f[2]}this.set("_format",a);a=null},_bindSelectedFulldate:function(a,j,g,d){if(this.showLongDate){var f=new Date(a,j,g).toString().slice(0,15);return f.slice(0,3)+","+f.slice(3)}var b=a;var k=_monthNames[j];var h=g;var i="";if(d.y==="yy"){b=a%100}if(d.m==="mmm"){k=k.slice(0,3)}else{if(d.m==="mm"){k=this._padStart(j+1,2,"0")}else{if(d.m==="m"){k=j+1}}}if(d.d==="do"){var e=h%10;var c=e>3?"th":["th","st","nd","rd"][e];if(h===11||h==12||h===13){c="th"}h=h+c}else{if(d.d==="dd"){h=this._padStart(h,2,"0")}}i=[b,d.s1,k,d.s2,h].join("");return i},_updateBindDate:function(a){this.debounce("_updateBindDate",function(){var d=a.type;if(d==="tap"){this.set("_isSelectedDateConfirmed",!0)}if(d==="transitionend"||this.noAnimation){if(this._isSelectedDateConfirmed){var c=this._selectedYear;var e=this._selectedMonth;var b=this._selectedDate;var g=this._format;var f=this._bindSelectedFulldate(c,e,b,g);this._setDate(f);this.set("_isSelectedDateConfirmed",!1)}}},1)},_computeShowLongDate:function(c){var a=this._isUndefined(this._selectedDate);if(c){var b=new Date(this._selectedYear,this._selectedMonth,this._selectedDate).toString().slice(0,15);b=a?new Date().toString().slice(0,15):b;this._setDate(b.slice(0,3)+","+b.slice(3))}else{var b=this._bindSelectedFulldate(this._selectedYear,this._selectedMonth,this._selectedDate,this._format);b=a?this.date:b;this._setDate(b)}},_updateToReflectExternalChange:function(k){function a(m){var o=isNaN(parseFloat(m));if(o){var p=/([0-9]+)[t|h|r|s|n|d]/i;var n=p.exec(m)!==null;if(n){return("0"+m).slice(-2)}else{return m}}else{return m/1000<1?("0"+m).slice(-2):("0"+m).slice(-4)}}var i=this.showLongDate;var c=0;var l=0;var g=0;var j=new Date(k);this._setInvalidDate(!1);if(!i){var h=/(\w+)[^a-zA-Z0-9]+(\w+)[^a-zA-Z0-9]+(\w+)/i;var b=h.exec(k);if(b===null){this._setInvalidDate(!0);return}var f=a(b[1]);var l=a(b[2]);var d=a(b[3]);var e=[f,l,d].join("-");j=new Date(e)}if(j=="Invalid Date"){this._computeShowLongDate(i);this._setInvalidDate(!0);return}c=j.getFullYear();l=j.getMonth();g=j.getDate();this.set("_activeYear",c);this.set("_activeMonth",l);this.set("_selectedYear",c);this.set("_selectedMonth",l);this.set("_selectedDate",g);this._computeShowLongDate(i)},enforceDateChange:function(){this._computeShowLongDate(this.showLongDate)},_padStart:function(c,e,b){var a=-e;var d=(b+c).slice(a);return d},_isUndefined:function(a){return a===undefined},_isNumber:function(a){return typeof a=="number"||(!isNaN(parseFloat(a))&&isFinite(a))}});</script></dom-module>
